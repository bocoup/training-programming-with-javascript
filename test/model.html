<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <link rel='stylesheet' href='../vendor/test/mocha.css'>
  <script src='../vendor/test/mocha-1.17.1.js'></script>
  <script src='../vendor/test/chai-1.9.0.js'></script>
  <script src='../vendor/jquery-2.1.0.js'></script>
  <script src='../app/hangman.js'></script>
  <script src='../app/lib/model.js'></script>
  <script src='//localhost:35729/livereload.js'></script>
  <script>
  var expect = chai.expect;
  mocha.setup('bdd');
  $(mocha.run);

  describe('Hangman.Model', function() {
    var model;

    beforeEach(function () {
      model = new Hangman.Model(['hangman']);
    });

    describe('constructor', function () {
      it('should create a new game state', function () {
        expect(model.guessWord).to.be.a('string');
        expect(model.hits).to.be.an('array');
        expect(model.hits).to.have.length(0);
        expect(model.misses).to.be.an('array');
        expect(model.misses).to.have.length(0);
      });

      it('should randomly select a word from a wordlist', function () {
        expect(model.guessWord).to.equal('hangman');
      });
    });

    describe('#guessWordLetters', function () {
      it('should split the word to guess into an array of characters', function () {
        expect(model.guessWordLetters()).to.deep.equal(model.guessWord.split(''));
      });
    });

    describe('#guesses', function () {
      it('should return an array of all hits and misses', function () {
        model.guess('a');
        model.guess('b');
        expect(model.guesses()).to.deep.equal(['a','b']);
      });
    });

    describe('#validateGuess', function () {
      it('should return true if guess is a single letter that hasn\'t been guessed yet', function () {
        expect(model.validateGuess(1)).to.be.false;
        expect(model.validateGuess('')).to.be.false;
        expect(model.validateGuess(' ')).to.be.false;
        expect(model.validateGuess('aa')).to.be.false;
        model.guess('c');
        expect(model.validateGuess('c')).to.be.false;
        expect(model.validateGuess('a')).to.be.true;
      });
    });

    describe('#compareGuessToWord', function () {
      it('should return the positions where a guess appears in the word', function() {
        var positions = model.compareGuessToWord('a');
        expect(positions.length).to.equal(2);
        expect(positions[0]).to.equal(1);
        expect(positions[1]).to.equal(5);
      });

      it('should return an empty array if the guess does not appear in the word', function() {
        var positions = model.compareGuessToWord('z');
        expect(positions.length).to.equal(0);
      });
    });

    describe('#guess', function () {
      it('should add the guessed letter to hits if it is in the word and hasn\'t been guessed', function () {
        model.guess('z');
        expect(model.hits).to.have.length(0);
        model.guess('a');
        expect(model.hits[0]).to.equal('a');
        model.guess('a');
        expect(model.hits).to.have.length(1);
      });

      it('should add the guessed letter to the list of guesses if it is valid and hasn\'t been guessed already', function () {
        model.guess('z');
        expect(model.hits).to.have.length(0);
        model.guess('a');
        expect(model.hits[0]).to.equal('a');
        model.guess('a');
        expect(model.hits).to.have.length(1);
      });

      it('should return true if the guess was a hit and hasn\'t been guessed already', function () {
        expect(model.guess('a')).to.be.true;
        expect(model.guess('a')).to.be.false;
      });
    });

    describe('#serialize', function () {
      it('should return a serialized copy of relevant model data for usage by views', function () {
        model.guess('a');
        model.guess('b');
        var serialize = model.serialize();
        expect(serialize.guessWordLetters).to.deep.equal(['h', 'a', 'n', 'g', 'm', 'a', 'n']);
        expect(serialize.hits).to.deep.equal(['a']);
        expect(serialize.misses).to.deep.equal(['b']);
      });
    });
  });
  </script>
</head>
<body>
  <div id='mocha'></div>
  <div id='test'></div>
</body>
</html>
