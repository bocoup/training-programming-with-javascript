<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <link rel='stylesheet' href='../vendor/test/mocha.css'>
  <script src='../vendor/test/mocha-1.17.1.js'></script>
  <script src='../vendor/test/chai-1.9.0.js'></script>
  <script src='../vendor/test/sinon-1.8.2.js'></script>
  <script src="../vendor/jquery-2.1.0.js"></script>
  <script src="../vendor/fabric-1.4.4.js"></script>
  <script src="../app/hangman.js"></script>
  <script src="../app/lib/model.js"></script>
  <script src="../app/lib/view.js"></script>
  <script src="../app/lib/controller.js"></script>
  <script src="//localhost:35729/livereload.js"></script>
  <script>
  var expect = chai.expect;
  mocha.setup('bdd');
  $(mocha.run);

  describe("Hangman.Controller", function() {
    var board, model, view, controller;

    beforeEach(function () {
      board = $('.hangman').clone();
      model = new Hangman.Model(['hangman']);
      view = new Hangman.View(board);
      controller = new Hangman.Controller(model, view);
      spies = {
        refreshGame: sinon.spy(controller, 'refreshGame'),
        refreshBoard: sinon.spy(view, 'refreshBoard'),
        guess: sinon.spy(controller, 'guess'),
        serialize: sinon.spy(model, 'serialize')
      };
      controller.start();
    });

    describe('#start', function () {
      it('should call refreshGame', function () {
        expect(spies.refreshGame.called).to.be.true;
      });

      it('should wire guess button to controller', function () {
        view.guessField.val('a');
        view.button.trigger('click');
        expect(spies.guess.called).to.be.true;
        expect(spies.guess.calledWith('a')).to.be.true;
      });
    });

    describe('#guess', function () {
      it('should send guess to model', function () {
        controller.guess('b');
        expect(model.misses).to.deep.equal(['b']);
      });

      it('should call refreshGame', function () {
        controller.guess('b');
        expect(spies.refreshGame.called).to.be.true;
      });
    });

    describe('#refreshGame', function () {
      it('should call refreshBoard on the view with the serialized model', function () {
        controller.refreshGame();
        expect(spies.refreshBoard.calledWith(model.serialize())).to.be.true;
      });
    });
  });
  </script>
</head>
<body>
  <div id="mocha"></div>
  <div id="test"></div>
  <div class="hangman" style="display:none">
    <div class="wrap">
      <h1>Hangman in HTML, CSS &amp; Javascript</h1>
      <div class="canvas">
        <canvas width="580" height="450"></canvas>
      </div>
      <div class="board"></div>
      <div class="input">
        <input type="text" name="guess" class="guess" maxlength="1"><button>Guess a Letter</button>
      </div>
      <div class="used">
        <span class="misses"></span><span class="title">Missed Letters</span>
      </div>
    </div>
  </div>
</body>
</html>
